#!/usr/bin/env node

const { program } = require("commander");
const fs = require("fs-extra");
const path = require("path");
const chalk = require("chalk");
const pkg = require(require("path").resolve(__dirname, "..", "package.json"));

program
  .name("egka-ai")
  .description("EgKa AI Agents - Cursor IDE iÃ§in AI Agent sistemi")
  .version(pkg.version);

program
  .command("init")
  .description(".cursor/rules ve agents klasÃ¶rlerini mevcut dizine kopyalar")
  .action(async () => {
    try {
      console.log(chalk.blue("ğŸš€ EgKa AI Agents kurulumu baÅŸlÄ±yor..."));

      // Hedef dizinleri belirle
      const targetDir = process.cwd();
      const packageDir = path.dirname(__dirname); // bin klasÃ¶rÃ¼nÃ¼n Ã¼st dizini

      console.log(chalk.gray(`ğŸ“ Hedef dizin: ${targetDir}`));
      console.log(chalk.gray(`ğŸ“¦ Paket dizini: ${packageDir}`));

      // .cursor/rules klasÃ¶rÃ¼nÃ¼ oluÅŸtur
      const cursorRulesDir = path.join(targetDir, ".cursor", "rules");
      await fs.ensureDir(cursorRulesDir);

      // new-chat-rules.mdc dosyasÄ±nÄ± kopyala
      const sourceRulesFile = path.join(
        packageDir,
        ".cursor",
        "rules",
        "new-chat-rules.mdc"
      );
      const targetRulesFile = path.join(cursorRulesDir, "new-chat-rules.mdc");

      if (await fs.pathExists(sourceRulesFile)) {
        await fs.copy(sourceRulesFile, targetRulesFile);
        console.log(
          chalk.green("âœ… .cursor/rules/new-chat-rules.mdc kopyalandÄ±")
        );
      } else {
        console.log(chalk.yellow("âš ï¸  new-chat-rules.mdc dosyasÄ± bulunamadÄ±"));
      }

      // agents klasÃ¶rÃ¼nÃ¼ kopyala
      const sourceAgentsDir = path.join(packageDir, "agents");
      const targetAgentsDir = path.join(targetDir, "agents");

      if (await fs.pathExists(sourceAgentsDir)) {
        await fs.copy(sourceAgentsDir, targetAgentsDir);
        console.log(chalk.green("âœ… agents klasÃ¶rÃ¼ kopyalandÄ±"));

        // Alt klasÃ¶rleri oluÅŸtur (mevcut iÃ§erikleri koru)
        const subDirs = ["docs", "logs", "prompts", "tasks"];
        for (const subDir of subDirs) {
          const dirPath = path.join(targetAgentsDir, subDir);
          await fs.ensureDir(dirPath);
        }
        console.log(
          chalk.green(
            "âœ… agents alt klasÃ¶rleri oluÅŸturuldu (mevcut iÃ§erik korunur)"
          )
        );
      } else {
        console.log(chalk.yellow("âš ï¸  agents klasÃ¶rÃ¼ bulunamadÄ±"));
      }

      console.log(chalk.green.bold("ğŸ‰ EgKa AI Agents baÅŸarÄ±yla kuruldu!"));
      console.log(chalk.blue("ğŸ“ Kurulum dizini:"), targetDir);
      console.log("");
      console.log(
        chalk.cyan(
          "Kurulum tamamlandÄ±. ArtÄ±k Cursor'da AI agent sisteminizi kullanabilirsiniz."
        )
      );
    } catch (error) {
      console.error(
        chalk.red("âŒ Kurulum sÄ±rasÄ±nda hata oluÅŸtu:"),
        error.message
      );
      process.exit(1);
    }
  });

program.parse();
